@model IEnumerable<PruebaTecnica.Models.UsersModel>

@{
    ViewData["Title"] = "Usuarios";
}

<h1>Usuarios</h1>

<table class="table align-middle">
    <thead>
        <tr>
            <th>Email</th>
            <th>Contraseña</th>
            <th style="width: 120px;"></th>
        </tr>
    </thead>
    <tbody> 
        @foreach (var item in Model)
        {
            var pwdId = $"pwd_{item.Id}";
            <tr>
                <td>@item.Email</td>
                <td>
                    <span id="@pwdId" class="password-mask" data-password="@item.Password">********</span>
                    <button type="button" class="btn btn-link btn-sm p-0 ms-2 toggle-password" data-target="@pwdId" tabindex="-1">
                        <i class="bi bi-eye"></i>
                    </button>
                </td>
                <td>
                    <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-warning btn-sm me-2" title="Editar">
                        <i class="bi bi-pencil-square"></i>
                    </a>
                    <form asp-action="Delete" asp-route-id="@item.Id" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-danger btn-sm" title="Eliminar"
                                onclick="return confirm('¿Eliminar este usuario?');">
                            <i class="bi bi-trash"></i>
                        </button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

<h2>Crear nuevo usuario</h2>
<form asp-action="Create" method="post" style="max-width:500px;margin:auto;">
    <div class="form-group mb-3">
        <label for="Email">Email</label>
        <input name="Email" class="form-control" type="email" required />
    </div>
    <div class="form-group mb-3">
        <label for="Password">Password</label>
        <div class="input-group">
            <input name="Password" id="createPassword" class="form-control" type="password" required />
            <button type="button" class="btn btn-outline-secondary toggle-password-input" data-target="createPassword" tabindex="-1">
                <i class="bi bi-eye"></i>
            </button>
        </div>
    </div>
    <button type="submit" class="btn btn-primary w-100 mt-3">
        <i class="bi bi-person-plus"></i> Crear
    </button>
</form>

<style>
    .password-mask {
        display: inline-block;
        min-width: 120px;
        text-align: left;
        vertical-align: middle;
        white-space: pre;
    }
    .toggle-password i {
        font-size: 1.2rem;
        vertical-align: middle;
    }
    main {
        min-height: 142vh;
        max-width: 1100px;
        margin: 2rem auto 0 auto;
        padding: 2.5rem 2rem 5rem 2rem;
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 2px 16px rgba(0,0,0,0.06);
       }
   </style>

@section Scripts {
<script>
    // Mostrar/ocultar contraseñas en la lista
    document.querySelectorAll('.toggle-password').forEach(btn => {
        btn.addEventListener('click', function () {
            const targetId = this.getAttribute('data-target');
            const span = document.getElementById(targetId);
            const icon = this.querySelector('i');
            if (span.textContent === '********') {
                span.textContent = span.getAttribute('data-password');
                icon.classList.remove('bi-eye');
                icon.classList.add('bi-eye-slash');
            } else {
                span.textContent = '********';
                icon.classList.remove('bi-eye-slash');
                icon.classList.add('bi-eye');
            }
        });
    });

    // Mostrar/ocultar contraseña en el input de crear usuario
    document.querySelectorAll('.toggle-password-input').forEach(btn => {
        btn.addEventListener('click', function () {
            const inputId = this.getAttribute('data-target');
            const input = document.getElementById(inputId);
            const icon = this.querySelector('i');
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('bi-eye');
                icon.classList.add('bi-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('bi-eye-slash');
                icon.classList.add('bi-eye');
            }
        });
    });
</script>
}